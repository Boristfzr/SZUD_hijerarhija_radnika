#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define MAX_NAME_LENGTH 100

typedef struct Radnik {
    char ime[MAX_NAME_LENGTH];  
    struct Radnik* menadzer;   
    struct Radnik* podredjeni;  
    struct Radnik* sledeci;     
} Radnik;

Radnik* kreiraj_radnika(const char* ime) {
    Radnik* r = (Radnik*)malloc(sizeof(Radnik));
    strncpy(r->ime, ime, MAX_NAME_LENGTH);
    r->menadzer = NULL;
    r->podredjeni = NULL;
    r->sledeci = NULL;
    return r;
}

Radnik* pronadji_radnika(Radnik* radnik, const char* ime) {
    if (radnik == NULL) return NULL;
    if (strcmp(radnik->ime, ime) == 0) return radnik;
    
    Radnik* pronadjen = pronadji_radnika(radnik->podredjeni, ime);
    if (pronadjen != NULL) return pronadjen;
    
    return pronadji_radnika(radnik->sledeci, ime);
}



void dodaj_radnika(Radnik* menadzer) {
    char ime[MAX_NAME_LENGTH];
    printf("Unesite ime novog radnika: ");
    printf("Unesite ime novog radnika (npr. 'Jelena - Zaposleni'): ");
    scanf(" %[^\n]", ime); // ƒçita ceo red sa razmacima

    const char* suffix = " - Zaposleni";
    int ime_len = strlen(ime);
    int suffix_len = strlen(suffix);

    if (ime_len >= suffix_len && strcmp(ime + ime_len - suffix_len, suffix) == 0) {
        Radnik* novi_radnik = kreiraj_radnika(ime);
        dodaj_podredjenog(menadzer, novi_radnik);
        printf("Radnik je uspe≈°no dodat.\n");
    } else {
        printf("Neispravan format imena! Radnik mora imati sufiks '- Zaposleni'.\n");
    }
}

int ukloni_radnika(Radnik* menadzer, const char* ime) {
    if (menadzer == NULL) return 0;

    Radnik* prethodni = NULL;
    Radnik* trenutni = menadzer->podredjeni;

    while (trenutni != NULL) {
        if (strcmp(trenutni->ime, ime) == 0) {

            if (prethodni == NULL) {
                menadzer->podredjeni = trenutni->sledeci;
            } else {
                prethodni->sledeci = trenutni->sledeci;
            }

            free(trenutni);
            printf("Radnik '%s' je uspe≈°no uklonjen.\n", ime);
            return 1;
        }

        // üîÅ REKURZIJA ‚Äì tra≈æimo kod podreƒëenih
        if (ukloni_radnika(trenutni, ime)) {
            return 1;
        }

        prethodni = trenutni;
        trenutni = trenutni->sledeci;
    }





void ispis_hijerarhije(Radnik* radnik, int nivo) {
    if (radnik == NULL) return;

    for (int i = 0; i < nivo; i++) {
        printf("  ");
    }
    printf("%s\n", radnik->ime);

    ispis_hijerarhije(radnik->podredjeni, nivo + 1);
    
    ispis_hijerarhije(radnik->sledeci, nivo);
}

int main() {
    Radnik* direktor = kreiraj_radnika("Zoran - Direktor");
    Radnik* menadzer1 = kreiraj_radnika("Dragan - Menad≈æer");
    Radnik* menadzer2 = kreiraj_radnika("Ljubica - Menad≈æer");
    Radnik* zaposleni1 = kreiraj_radnika("Radoslav - Zaposleni");
    Radnik* zaposleni2 = kreiraj_radnika("Boris - Zaposleni");
    Radnik* zaposleni3 = kreiraj_radnika("Marko - Zaposleni");

    dodaj_podredjenog(direktor, menadzer1);
    dodaj_podredjenog(direktor, menadzer2);
    
    dodaj_podredjenog(menadzer1, zaposleni1);
    dodaj_podredjenog(menadzer1, zaposleni2);
    dodaj_podredjenog(menadzer2, zaposleni3);


    printf("Trenutna hijerarhija:\n");
    ispis_hijerarhije(direktor, 0);

    printf("\nUnesite ime radnika kojeg ≈æelite da uklonite: ");
    char ime_radnika[MAX_NAME_LENGTH];
    scanf(" %[^\n]", ime_radnika);

    ukloni_radnika(direktor, ime_radnika);
    
    printf("\nA≈æurirana hijerarhija:\n");
    ispis_hijerarhije(direktor, 0);
    
    Radnik* radnik = pronadji_radnika(direktor, ime);
    if (radnik != NULL) {
        printf("Radnik %s je pronaƒëen\n", ime);
    } else {
        printf("Radnik nije pronaƒëen\n");

        switch (izbor) {
            case 1:
                printf("\nHijerarhija firme:\n");
                ispis_hijerarhije(direktor, 0);
                break;

     printf("\nUnesite ime menad≈æera pod kojim ≈æelite da dodate novog radnika: ");
    char ime_menadzera[MAX_NAME_LENGTH];
    scanf(|"%[^\n", ime_menadzera);

    Radnik* menadzer = pronadji_radnika(direktor, ime_menadzera);
    if (menadzer != NULL) {
        dodaj_radnika(menadzer);
        printf("\nA≈æurirana hijerarhija:\n");
        ispis_hijerarhije(direktor, 0);
    } else {
        printf("Menad≈æer sa imenom %s nije pronaƒëen.\n", ime_menadzera);
    }
    

    free(direktor);
    free(menadzer1);
    free(menadzer2);
    free(zaposleni1);
    free(zaposleni2);
    free(zaposleni3);
    }
}
    return 0;
